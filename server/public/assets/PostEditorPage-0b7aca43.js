import{p as f,O as F,G as E,H as D,J as L,j as s,x as T,K as v,A as m,N as S,R as j,E as k,r as A}from"./index-108ef3d0.js";import{p as P,a as b,i as K,j as U,h as H,F as R}from"./PostTagSelect-cb5b3bc8.js";import{H as w}from"./Header-6aeb6c6a.js";import{A as g}from"./AlertTitle-f94e8cb7.js";import"./FileUploadBody-f68dc815.js";const I=()=>f({mutationKey:P.mutations.create(),mutationFn:async e=>(await F(2e3),await b.createPost(e))}),O=()=>f({mutationKey:P.mutations.update(),mutationFn:async({id:e,post:t})=>await b.updatePostById(e,t)}),G=()=>f({mutationKey:P.mutations.delete(),mutationFn:async e=>await b.deletePostById(e)}),N={title:"",description:"",body:"",image:null,tags:[]};function C(e){const{post:t,onSubmit:a,isLoading:r,edit:o}=e,n=E(),{control:i,handleSubmit:c}=D({resolver:L(K),defaultValues:N,values:t||N});return s.jsxs("form",{onSubmit:c(a),className:"flex flex-col gap-2 w-full",children:[s.jsx(U,{control:i,isLoading:r}),s.jsxs("div",{className:"flex items-center gap-x-2",children:[s.jsx(T,{loading:r,type:"submit",variant:"contained",disableElevation:!0,children:o?"Save changes":"Create"}),o&&t&&s.jsx(V,{id:t.id,trigger:s.jsx(v,{color:"error",variant:"contained",disableElevation:!0,children:"Delete"})}),s.jsx(v,{onClick:()=>n(-1),children:"Cancel"})]})]})}function J(){var d;const{mutate:e,isPending:t,isError:a,error:r,isSuccess:o,data:n}=I(),i=E(),c=async u=>{e({...u,tags:u.tags.map(l=>l.id)},{onSuccess:l=>{i(j.posts.slug(l.slug))}})};return s.jsxs(s.Fragment,{children:[s.jsx(w,{value:"Create new post"}),o&&s.jsxs(m,{className:"mb-2",children:[s.jsx(g,{children:"Post created successfully"}),"To see the created post"," ",s.jsx(S,{className:"underline font-semibold",to:j.posts.slug(n.slug),children:"Click here"})]}),a&&s.jsxs(m,{className:"mb-2",severity:"error",children:[s.jsx(g,{children:"Error while creating post"}),(d=r.response)==null?void 0:d.data.message]}),s.jsx(C,{onSubmit:c,isLoading:t,isError:a})]})}function M(){var x,p;const{postSlug:e}=k(),{data:t,isLoading:a,isError:r,error:o}=H(e),{mutate:n,isError:i,error:c,isSuccess:d,data:u}=O(),l=async h=>{const y={...h,tags:h.tags.map(B=>B.id)};n({id:t.id,post:y},{onSuccess:()=>{window.scrollTo(0,0)}})};return s.jsxs(s.Fragment,{children:[s.jsx(w,{value:"Update post"}),d&&s.jsxs(m,{className:"mb-2",children:[s.jsx(g,{children:"Post updated successfully"}),"To see the updated post"," ",s.jsx(S,{className:"underline font-semibold",to:j.posts.slug(u.slug),children:"Click here"})]}),r&&s.jsxs(m,{className:"mb-2",severity:"error",children:[s.jsx(g,{children:"Error while loading post data"}),(x=o.response)==null?void 0:x.data.message]}),i&&s.jsxs(m,{className:"mb-2",severity:"error",children:[s.jsx(g,{children:"Error while updating post"}),(p=c.response)==null?void 0:p.data.message]}),s.jsx(C,{post:t,isLoading:a,isError:r,onSubmit:l,edit:!0})]})}function V(e){var p;const{trigger:t,id:a}=e,[r,o]=A.useState(!1),{mutate:n,isPending:i,isError:c,error:d,reset:u}=G(),l=E(),x=async h=>{h.preventDefault(),n(a,{onSuccess:y=>{console.log(y),o(!1),l(j.posts.index)}})};return s.jsx(R,{trigger:t,open:r,reset:u,setOpen:o,title:"Delete post",handleSubmit:x,isLoading:i,primaryButtonColor:"error",primaryButtonName:"Yes, delete post",secondaryButtonName:"No, keep post",secondaryButtonColor:"primary",children:s.jsxs(s.Fragment,{children:[c&&s.jsx(m,{className:"mb-2",severity:"error",children:(p=d.response)==null?void 0:p.data.message}),s.jsxs("p",{children:["Are you sure you want to delete this post?"," ",s.jsx("span",{className:"font-semibold",children:"This action cannot be undone."})]})]})})}function X({edit:e}){return e?s.jsx(M,{}):s.jsx(J,{})}export{X as default};
